<!--[include file="newsletter_admin_std_header.html"]-->
<!--[add_additional_header header='<script type="text/javascript" src="modules/Newsletter/pnjavascript/checkall.js"></script>']-->
<!--[pnajaxheader modname="Newsletter" filename="newsletter.js"]-->
<!--[pnajaxheader modname="Newsletter"]-->

<script type="text/javascript">
	function disableSendChecked(){
		send2users.sendChecked.disabled = true;
	}
	onload = disableSendChecked;
</script>

<!--[newsletter_selector_active assign="active_values" return_keys=true all=true]-->
<!--[newsletter_selector_active assign="active_output" return_keys=false all=true]-->
<!--[newsletter_selector_approved assign="approved_values" return_keys=true all=true]-->
<!--[newsletter_selector_approved assign="approved_output" return_keys=false all=true]-->
<!--[newsletter_selector_frequency assign="frequency_values" return_keys=true all=true]-->
<!--[newsletter_selector_frequency assign="frequency_output" return_keys=false all=true]-->
<!--[newsletter_selector_language assign="language_values" return_keys=true all=true]-->
<!--[newsletter_selector_language assign="language_output" return_keys=false all=true]-->
<!--[newsletter_selector_type assign="type_values" return_keys=true all=true]-->
<!--[newsletter_selector_type assign="type_output" return_keys=false all=true]-->

<!--[pnml assign="pageTitle" name="Subscribers"]-->
<!--[pnpagesetvar name="title" value=$pageTitle]-->
<!--[pnsecgenauthkey assign="authid" module="Newsletter"]-->
<!--[pnmodgetvar assign="enable_multilingual" module="Newsletter" name="enable_multilingual" default=0]-->

<!--[pnsessiongetvar assign="currPagesize" name="pagesize" default="25" path="/Newsletter"]-->

<div class="pn-admincontainer">
  <br />
  <h2><!--[$pageTitle]--></h2>

  <form action="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot]-->" name="langfilter" method="post" enctype="application/x-www-form-urlencoded">
    <!--[gt text="All" assign="lblAll"]-->
    <!--[gt text="Filter" assign="lblFilter"]-->

    <fieldset>
      <legend><strong><!--[gt text="Usersearch"]--></strong></legend>
        
      <div id="liveusersearch" class="pn-hide">
        <div>
          <!--[gt text="Search"]-->&nbsp;<input size="30" maxlength="30" name="filter[search]" id="filter_search" value="" />
          <!--[pnimg id="ajax_indicator" style="display: none;" modname='core' set='icons/extrasmall' src="indicator_circle.gif" __alt=""]-->

          <div id="filter_search_choices" class="nl_autocomplete_user"></div>
          <script type="text/javascript">
            liveusersearch();
          </script>
        </div>
        <div style="text-align:right;">
          <!--[php]-->
              $psArray = array();
              $psArray[25]   = 25;
              $psArray[50]   = 50;
              $psArray[75]   = 75;
              $psArray[100]  = 100;
              $psArray[250]  = 250;
              $psArray[500]  = 500;
              $psArray[750]  = 750;
              $psArray[1000] = 1000;
              $psArray[-1]   = All;
              $this->assign ('pagesizes', $psArray);
          <!--[/php]-->
          <!--[gt text="Display # of users per page:"]--> 
          <!--[foreach from=$pagesizes key="amount" item="label"]-->
            <!--[if ($amount == $currPagesize)]-->
              <!--[$label]-->&nbsp;
            <!--[else]-->
              <a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot="user" pagesize=$amount]-->"><!--[$label]--></a>&nbsp;
            <!--[/if]-->
          <!--[/foreach]-->
        </div>
      </div>        
    </fieldset>
 
    <fieldset>
      <legend><strong>&nbsp;<!--[$lblFilter]-->&nbsp;</strong></legend>
      <table width=90%>
        <tr>
          <!--[if ($enable_multilingual)]-->
            <td align="center">
              <!--[gt text="Language"]-->&nbsp;
              <select id="filter_lang" name="filter[lang]" onchange="this.form.submit();"><!--[html_options values=$language_values output=$language_output selected=$filter.lang]--></select>
            </td>
          <!--[/if]-->
          <td align="center">
            <!--[gt text="Type"]-->&nbsp;
            <select id="filter_type" name="filter[type]" onchange="this.form.submit();"><!--[html_options values=$type_values output=$type_output selected=$filter.type]--></select>
          </td>
          <td align="center">
            <!--[gt text="Frequency"]-->&nbsp;
            <select id="filter_frequency" name="filter[frequency]" onchange="this.form.submit();"><!--[html_options values=$frequency_values output=$frequency_output selected=$filter.frequency|default:-1]--></select>
          </td>
          <td align="center">
            <!--[gt text="Active"]-->&nbsp;
            <select id="filter_active" name="filter[active]" onchange="this.form.submit();"><!--[html_options values=$active_values output=$active_output selected=$filter.active]--></select>
          </td>
          <td align="center">
            <!--[gt text="Approved"]-->&nbsp;
            <select id="filter_approved" name="filter[approved]" onchange="this.form.submit();"><!--[html_options values=$approved_values output=$approved_output selected=$filter.approved]--></select>
          </td>
    
        </tr>
      </table>
    </fieldset>
  </form>
  <br />
  <form name="send2users" action="<!--[pnmodurl modname="Newsletter" type="adminform" func="edit"]-->" method="post" enctype="application/x-www-form-urlencoded">
    <input type="hidden" name="authid" value="<!--[$authid]-->" />
    <input type="hidden" name="ot" value="newsletter_send" />
    <input type="hidden" name="otTarget" value="user" />
    <input type="hidden" name="sendType" value="manual" />
    <!--[if ($enable_multilingual)]-->
        <input type="hidden" name="language" value="<!--[$filter.lang]-->" />
    <!--[else]-->
        <!--[pnconfiggetvar assign="defaultlang" name="language" default="eng"]-->
        <input type="hidden" name="language" value="<!--[$defaultlang]-->" />
    <!--[/if]-->
    <table class="pn-admintable" summary="<!--[$pageTitle]-->" width="100%">
      <thead>

        <tr>
          <th><input type="checkbox" onclick="checkAllFields(1);" id="checkAll" /></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'uid';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="User ID"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'name';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Username"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'email';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Email"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'lang';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Language"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'type';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Type"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'frequency';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Frequency"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'active DESC';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Active"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'approved DESC';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Approved"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'last_send_date DESC';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Last sent"]--></a></th>
          <!--[php]-->
             $this->_tpl_vars['filter']['sort'] = 'cr_date DESC';
          <!--[/php]-->
          <th><a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot=$ot filter=$filter]-->"><!--[gt text="Joindate"]--></a></th>
          <th align="right"><!--[gt text="Action"]--></th>
        </tr>
      </thead>
      <tbody>
        <!--[securityutil_checkpermission assign="adminAuth" component="Newsletter::" instance="::" level="ACCESS_ADMIN"]-->
        <!--[pnml assign="yes"       name="Yes"]-->
        <!--[pnml assign="no"        name="No"]-->
        <!--[pnml assign="qActive"   name="Are you sure you wish to change the active status for this user?"]-->
        <!--[pnml assign="qApproved" name="Are you sure you wish to change the approved status for this user?"]-->
        <!--[pnml assign="lblEdit"   name="Edit"]-->
        <!--[pnml assign="lblDelete" name="Delete"]-->
        <!--[foreach from=$objectArray item=user]-->
          <tr class="<!--[cycle values="pn-odd,pn-even"]-->">
            <td><input type="checkbox" name="user_array[]" value="<!--[$user.id|pnvarprephtmldisplay]-->" onclick="checkAllFields(2);" /></td>
            <td><!--[if ($user.uid > 1)]--><a href="<!--[pnmodurl modname="Profile" type="user" func="view" uid=$user.uid]-->"><!--[$user.uid]--></a><!--[/if]--></td>
            <td><!--[$user.name|pnvarprephtmldisplay]--></td>
            <td><!--[$user.email|pnvarprephtmldisplay]--></td>
            <td><!--[$user.lang|pnvarprephtmldisplay]--></td>
            <td>
              <!--[if ($user.type == 1)]--><!--[gt text="Text"]-->
              <!--[elseif ($user.type == 2)]--><!--[gt text="HTML"]-->
              <!--[elseif ($user.type == 3)]--><!--[gt text="Text with Link to Archive"]-->
              <!--[else]-->??????<!--[$user.type]--><!--[/if]-->
            </td>
	    <td>
              <!--[if ($user.frequency == 0)]--><!--[gt text="Weekly"]-->
              <!--[elseif ($user.frequency == 1)]--><!--[gt text="Monthly"]-->
              <!--[elseif ($user.frequency == 2)]--><!--[gt text="Every 2 Months"]-->
              <!--[elseif ($user.frequency == 3)]--><!--[gt text="Every 3 Months"]-->
              <!--[elseif ($user.frequency == 6)]--><!--[gt text="Every 6 Months"]-->
              <!--[elseif ($user.frequency == 9)]--><!--[gt text="Every 9 Months"]-->
              <!--[elseif ($user.frequency == 12)]--><!--[gt text="Yearly"]-->
              <!--[else]-->??????<!--[$user.frequency]--><!--[/if]-->
            </td>
            <td><a href="<!--[pnmodurl modname="Newsletter" type="adminform" func="edit" ot="user_active" otTarget="user" id=$user.id authid=$authid filter=$filter]-->" onclick="return confirm('<!--[$qActive]-->');"><!--[if ($user.active)]--><!--[$yes]--><!--[else]--><!--[$no]--><!--[/if]--></a></td>
            <td><a href="<!--[pnmodurl modname="Newsletter" type="adminform" func="edit" ot="user_approved" otTarget="user" id=$user.id authid=$authid filter=$filter]-->" onclick="return confirm('<!--[$qApproved]-->');"><!--[if ($user.approved)]--><!--[$yes]--><!--[else]--><!--[$no]--><!--[/if]--></a></td>
            <td><!--[$user.last_send_date|pnvarprephtmldisplay]--></td>
            <td><!--[$user.cr_date|pnvarprephtmldisplay]--></td>
            <td class="nowrap" align="right">
              <!--[if ($adminAuth)]-->
                <a href="<!--[pnmodurl modname="Newsletter" type="admin" func="edit" ot=$ot id=$user.id authid=$authid]-->"><!--[pnimg src='xedit.gif' modname='core' set='icons/extrasmall' __alt=$lblEdit altml='false' __title=$lblEdit titleml='false']--></a>
                <a href="<!--[pnmodurl modname="Newsletter" type="adminform" func="delete" ot=$ot id=$user.id authid=$authid]-->" onclick="return confirm('<!--[$lblDelete]-->');"><!--[pnimg src='cancel.gif' modname='core' set='icons/extrasmall' __alt=$lblDelete altml='false' __title=$lblDelete titleml='false']--></a>
              <!--[/if]-->
            </td>
          </tr>
        <!--[/foreach]-->

        <tr>
          <td colspan="3">
            <!--[gt text="Update last sent date?"]-->
            <input type="checkbox" name="updateSendDate" value="1" />
            <em><!--[gt text="(checked=yes)"]--></em>
          </td>
          <td colspan="2" style="border:none;">
            <input type="hidden" name="authid" value="<!--[$authid]-->" />
            <input type="submit" value="<!--[gt text="Send to"]--> [0] <!--[gt text="Users"]-->" name="sendChecked" id="sendChecked" />
          </td>
          <td colspan="3" style="border:none; text-align:center;">
            <img src="images/icons/extrasmall/add_user.gif" alt="<!--[gt text="Add a user"]-->">&nbsp;<a href="<!--[pnmodurl modname="Newsletter" type="admin" func="edit" ot="user" authid=$authid]-->"><!--[gt text="Add a user"]--></a>
          </td>
          <td colspan="4" style="border:none; text-align:right;">
            <!--[gt text="Display # of users per page:"]--> 
            <!--[foreach from=$pagesizes key="amount" item="label"]-->
              <!--[if ($amount == $currPagesize)]-->
                <!--[$label]-->&nbsp;
              <!--[else]-->
                <a href="<!--[pnmodurl modname="Newsletter" type="admin" func="view" ot="user" pagesize=$amount]-->"><!--[$label]--></a>&nbsp;
              <!--[/if]-->
            <!--[/foreach]-->
          </td>
        </tr>

      </tbody>
    </table>
  </form>

</div>

<!--[pager rowcount=$pager.numitems limit=$pager.itemsperpage posvar=startnum shift=1 img_prev=images/icons/extrasmall/previous.gif img_next=images/icons/extrasmall/next.gif]-->

<!--[include file="newsletter_std_footer.html"]-->
